
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>스케줄 자동화</title>
  <style>
    body {
      background-color: #1e1e1e;
      color: #f0f0f0;
      font-family: 'Segoe UI', sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }
    .container {
      background-color: #2b2b2b;
      padding: 2rem;
      border-radius: 16px;
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
      width: 90%;
      max-width: 800px;
    }
    h1 {
      text-align: center;
      margin-bottom: 1rem;
    }
    textarea {
      width: 100%;
      height: 150px;
      background-color: #1e1e1e;
      color: #f0f0f0;
      border: 1px solid #555;
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
      font-size: 1rem;
    }
    button {
      background-color: #3a3a3a;
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      display: block;
      margin: 0 auto;
    }
    button:hover {
      background-color: #555;
    }
    #output {
      margin-top: 2rem;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>수업 스케줄 자동 조율기</h1>
    <textarea id="input" placeholder="예: 홍길동 / 3 / 월,수 15 / 금 16-18"></textarea>
    <button onclick="generateSchedule()">스케줄 조율</button>
    <div id="output"></div>
  </div>

  <script>
    function parseTimeRange(str) {
      if (!str) return [];
      if (str.includes('-')) {
        const [start, end] = str.split('-').map(Number);
        return Array.from({ length: end - start + 1 }, (_, i) => start + i);
      }
      return [Number(str)];
    }

    function parseInput(input) {
      const lines = input.trim().split('\n');
      return lines.map(line => {
        const [nameRaw, countRaw, ...timeParts] = line.split('/').map(s => s.trim());
        const times = timeParts.flatMap(part => part.split(',').map(s => s.trim()));
        const timeMap = {};
        times.forEach(t => {
          if (!t.includes(' ')) return;
          const [day, time] = t.split(' ');
          if (!timeMap[day]) timeMap[day] = [];
          timeMap[day].push(...parseTimeRange(time));
        });
        return {
          name: nameRaw,
          count: parseInt(countRaw, 10),
          availability: timeMap
        };
      });
    }

    function generateSchedule() {
      const inputText = document.getElementById('input').value;
      const requests = parseInput(inputText);
      const schedule = {};
      const resultMap = {};

      const days = ['월', '화', '수', '목', '금'];
      const hours = Array.from({ length: 9 }, (_, i) => 14 + i);
      days.forEach(day => {
        schedule[day] = {};
        hours.forEach(hour => {
          schedule[day][hour] = null;
        });
      });

      const sorted = [...requests].sort((a, b) => {
        const aOptions = Object.values(a.availability).reduce((sum, v) => sum + v.length, 0);
        const bOptions = Object.values(b.availability).reduce((sum, v) => sum + v.length, 0);
        return aOptions - bOptions;
      });

      sorted.forEach(req => {
        resultMap[req.name] = [];
        let count = 0;
        for (const day of days) {
          if (!req.availability[day]) continue;
          for (const hour of req.availability[day]) {
            if (schedule[day][hour] === null && !resultMap[req.name].some(t => t.includes(day))) {
              schedule[day][hour] = req.name;
              resultMap[req.name].push(`${day} ${hour}시`);
              count++;
              break;
            }
          }
          if (count >= req.count) break;
        }
      });

      let output = '🗓️ 스케줄 배정 결과\n\n';
      for (const name in resultMap) {
        output += `${name}: ${resultMap[name].length}회 (${resultMap[name].join(', ')})\n`;
      }

      output += '\n\n📅 시간표\n';
      output += '시간 | ' + days.join(' | ') + '\n';
      output += '-'.repeat(70) + '\n';
      hours.forEach(hour => {
        const row = [`${hour}시`];
        days.forEach(day => {
          row.push(schedule[day][hour] || '-');
        });
        output += row.join(' | ') + '\n';
      });

      document.getElementById('output').textContent = output;
    }
  </script>
</body>
</html>
