
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>수업 스케줄 자동 조율기 <6></title>
  <style>
    body { background-color: #1e1e1e; color: #f0f0f0; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 2rem; }
    .container { max-width: 900px; margin: auto; background-color: #2b2b2b; padding: 2rem; border-radius: 16px; box-shadow: 0 0 10px rgba(0,0,0,0.5); }
    h1 { text-align: center; margin-bottom: 1rem; }
    textarea { width: 100%; height: 150px; background-color: #1e1e1e; color: #f0f0f0; border: 1px solid #555; border-radius: 8px; padding: 1rem; margin-bottom: 1rem; font-size: 1rem; }
    button { background-color: #3a3a3a; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; font-size: 1rem; display: block; margin: 0 auto; }
    button:hover { background-color: #555; }
    #output { margin-top: 2rem; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    table, th, td { border: 1px solid #555; }
    th, td { padding: 0.5rem; text-align: center; }
    th { background-color: #3a3a3a; }
    td.highlight { background-color: #444; font-weight: bold; }
  </style>
</head>
<body>
  <div class="container">
    <h1>수업 스케줄 자동 조율기</h1>
    <textarea id="input" placeholder="예: 이진우 / 2번 / 월,수 15"></textarea>
    <button onclick="generateSchedule()">스케줄 조율</button>
    <div id="output"></div>
  </div>

  <script>
    const days = ['월', '화', '수', '목', '금'];
    const hours = Array.from({ length: 9 }, (_, i) => 14 + i);

    function parseTimeRange(str) {
      if (!str) return [];
      if (str.includes('-') || str.includes('~')) {
        const [start, end] = str.split(/-|~/).map(Number);
        return Array.from({ length: end - start + 1 }, (_, i) => start + i);
      }
      return [Number(str)];
    }

    function expandMultiDays(part) {
      const match = part.match(/^([월화수목금,]+)\s+(\d+(?:[-~]\d+)?)/);
      if (!match) return [part];
      const dayList = match[1].split(',');
      const time = match[2];
      return dayList.map(d => `${d} ${time}`);
    }

    function parseInput(input) {
      const lines = input.trim().split('
');
      return lines.map(line => {
        const [nameRaw, countRawRaw, ...timeParts] = line.split('/').map(s => s.trim());
        const countRaw = countRawRaw.replace(/[^0-9]/g, '');
        const timeStrings = timeParts.flatMap(part => part.split(',').map(p => p.trim()));
        const expandedTimes = timeStrings.flatMap(item => {
          if (item.match(/^([월화수목금,]+)\s+\d/)) {
            return expandMultiDays(item);
          } else {
            return [item];
          }
        });

        const timeMap = {};
        expandedTimes.forEach(t => {
          if (!t.includes(' ')) return;
          const [day, time] = t.split(' ');
          if (!timeMap[day]) timeMap[day] = [];
          timeMap[day].push(...parseTimeRange(time));
        });

        return {
          name: nameRaw,
          count: parseInt(countRaw, 10),
          availability: timeMap
        };
      });
    }

    function generateSchedule() {
      const inputText = document.getElementById('input').value;
      const requests = parseInput(inputText);
      const schedule = {};
      const resultMap = {};

      days.forEach(day => {
        schedule[day] = {};
        hours.forEach(hour => {
          schedule[day][hour] = null;
        });
      });

      const sorted = [...requests].sort((a, b) => {
        const aOptions = Object.values(a.availability).reduce((sum, v) => sum + v.length, 0);
        const bOptions = Object.values(b.availability).reduce((sum, v) => sum + v.length, 0);
        return aOptions - bOptions;
      });

      sorted.forEach(req => {
        resultMap[req.name] = [];
        let count = 0;
        const usedDays = new Set();

        for (const day of days) {
          if (!req.availability[day] || usedDays.has(day)) continue;
          for (const hour of req.availability[day]) {
            if (schedule[day][hour] === null) {
              schedule[day][hour] = req.name;
              resultMap[req.name].push(`${day} ${hour}시`);
              usedDays.add(day);
              count++;
              break;
            }
          }
          if (count >= req.count) break;
        }
      });

      let output = '<h3>🗓️ 배정 요약</h3><ul>';
      for (const name in resultMap) {
        output += `<li>${name}: ${resultMap[name].length}회 (${resultMap[name].join(', ')})</li>`;
      }
      output += '</ul><h3>📅 시간표</h3>';
      output += '<table><thead><tr><th>시간</th>' + days.map(d => `<th>${d}</th>`).join('') + '</tr></thead><tbody>';
      hours.forEach(hour => {
        output += `<tr><td>${hour}시</td>`;
        days.forEach(day => {
          const assigned = schedule[day][hour];
          output += `<td class="${assigned ? 'highlight' : ''}">${assigned || '-'}</td>`;
        });
        output += '</tr>';
      });
      output += '</tbody></table>';

      document.getElementById('output').innerHTML = output;
    }

    window.generateSchedule = generateSchedule;
  </script>
</body>
</html>
